mise:
  tools:
    node: "22"
    pnpm: latest
    task: latest
tasks:
  default:
    cmds:
      - task: install
      - task: dev

  install:
    cmds:
      - pnpm install && pnpm add graphql-ws
  dev:
    cmds:
      - pnpm run prepackage

  watch:
    cmds:
      - pnpm run watch
    deps:
      - install
      - setup
      - type-check
  build:
    cmds:
      - pnpm run package
    deps:
      - install
      - setup
      - type-check
  setup:
    desc: "Настройка проекта: копирование .env файла"
    cmds:
      - |
        {{if eq OS "windows"}} powershell {{end}} cp .env.example .env
  test:
    desc: Run tests
    cmds:
      - task: type-check
  type-check:
    cmds:
      - pnpm tsc --noEmit
    deps:
      - install
  version:
    desc: Обновление версии проекта (patch)
    cmds:
      - pnpm version patch
